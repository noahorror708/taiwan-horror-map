<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>å°ç£ææ€–åœ°åœ–</title>
  <style>
    body {
      margin:0;
      font-family: Arial, sans-serif;
      background:#111;
      color:#eee;
    }
    h1 {
      text-align:center;
      padding:15px;
      background:#222;
      color:#ff4444;
      margin:0;
    }
    #subtitle {
      text-align:center;
      padding:5px;
      background:#1a1a1a;
      color:#ccc;
      font-size:14px;
    }
    #map {
      height:50vh;   /* åªä½”ä¸ŠåŠ */
      width:100%;
    }
    #contentArea {
      display:flex;
      height:50vh;   /* ä¸‹åŠ */
    }
    #sidebar {
      width:250px;
      background:#222;
      overflow-y:auto;
      padding:10px;
    }
    #sidebar h2 {
      margin-top:0;
      color:#66ccff;
    }
    #sidebar input {
      width:90%;
      padding:5px;
      margin-bottom:10px;
      border:none;
      border-radius:4px;
    }
    #sidebar ul {
      list-style:none;
      padding:0;
    }
    #sidebar li {
      margin:5px 0;
    }
    #sidebar a {
      color:#eee;
      text-decoration:none;
      display:block;
      padding:5px;
      border-radius:6px;
    }
    #sidebar a:hover {
      background:#333;
    }
    #articleList {
      flex:1;
      background:#111;
      padding:15px;
      overflow-y:auto;
    }
    footer {
      background:#222;
      text-align:center;
      padding:15px;
      font-size:13px;
      color:#aaa;
    }
  </style>
</head>
<body>
  <h1>å°ç£ææ€–åœ°åœ–</h1>
  <div id="subtitle">æ”¶éŒ„å°ç£å„åœ°éˆç•°æ•…äº‹ã€éƒ½å¸‚å‚³èªªèˆ‡è©­è­šäº‹ä»¶</div>

  <div id="map"></div>

  <div id="contentArea">
    <div id="sidebar">
      <h2>ä¾åœ°å€åˆ†é¡</h2>
      <input type="text" id="searchBox" placeholder="ğŸ” æœå°‹æ–‡ç« ...">
      <div id="regions">è¼‰å…¥ä¸­...</div>
    </div>
    <div id="articleList">
      <h2>æ–‡ç« é¡¯ç¤ºå€</h2>
      <div id="articleContent">è«‹å¾å·¦é‚Šé¸æ“‡æ–‡ç« </div>
    </div>
  </div>

  <footer>
    ğŸ“© è¯çµ¡ä¿¡ç®±ï¼šnoahorror708@gmail.com <br>
    âš ï¸ å…è²¬è²æ˜ï¼šæœ¬ç«™æ•…äº‹åƒ…ä¾›å¨›æ¨‚åƒè€ƒï¼Œä¸ä»£è¡¨çœŸå¯¦äº‹ä»¶ã€‚
  </footer>

  <!-- Google Maps -->
  <script>
    let map;
    function initMap() {
      const taiwan = { lat: 23.6978, lng: 120.9605 };
      map = new google.maps.Map(document.getElementById("map"), {
        zoom: 7,
        center: taiwan,
      });
    }
  </script>
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDGoEL8NEw0Vt0X1SJbrFpi5WTI6zPwCoM8&callback=initMap">
  </script>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // Firebase è¨­å®š
    const firebaseConfig = {
      apiKey: AIzaSyDGoEL8NEw0Vt0X1SJbrFpi5WTI6zPwCoM,
      authDomain: "taiwan-horror-map-e257d.firebaseapp.com",
      projectId: "taiwan-horror-map-e257d",
      storageBucket: "taiwan-horror-map-e257d.appspot.com",
      messagingSenderId: "59145752144",
      appId: "1:59145752144:web:1f6ccc6fecd280defc8b55",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // æŠ“æ–‡ç« 
    async function loadPosts() {
      const querySnapshot = await getDocs(collection(db, "posts"));
      let groups = {};
      querySnapshot.forEach((doc) => {
        let data = doc.data();
        let region = data.region || "æœªåˆ†é¡";
        if (!groups[region]) groups[region] = [];
        groups[region].push({ id: doc.id, ...data });
      });
      renderSidebar(groups);
    }

    // å·¦å´åˆ†é¡ + æœå°‹
    function renderSidebar(groups) {
      const sidebar = document.getElementById("regions");
      sidebar.innerHTML = "";
      for (let region in groups) {
        let h3 = document.createElement("h3");
        h3.innerText = region;
        sidebar.appendChild(h3);

        let ul = document.createElement("ul");
        groups[region].forEach(post => {
          let li = document.createElement("li");
          let a = document.createElement("a");
          a.innerText = post.title;
          a.href = "#";
          a.onclick = () => showArticle(post);
          li.appendChild(a);
          ul.appendChild(li);
        });
        sidebar.appendChild(ul);
      }

      // æœå°‹åŠŸèƒ½
      document.getElementById("searchBox").addEventListener("input", (e) => {
        let keyword = e.target.value.toLowerCase();
        document.querySelectorAll("#regions a").forEach(a => {
          a.style.display = a.innerText.toLowerCase().includes(keyword) ? "block" : "none";
        });
      });
    }

    // é¡¯ç¤ºæ–‡ç« 
    function showArticle(post) {
      const area = document.getElementById("articleContent");
      area.innerHTML = `
        <h3>${post.title}</h3>
        <p><b>åœ°é»ï¼š</b>${post.locationName}</p>
        <p>${post.content}</p>
      `;
      if (post.coordinates) {
        let [lat, lng] = post.coordinates.split(",").map(Number);
        let pos = { lat, lng };
        map.setCenter(pos);
        map.setZoom(15);
        new google.maps.Marker({ position: pos, map: map, title: post.title });
      }
    }

    loadPosts();
  </script>
</body>
</html>
