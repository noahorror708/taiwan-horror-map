<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>å°ç£ææ€–åœ°åœ–</title>
  <style>
    body { margin:0; font-family:Arial,sans-serif; background:#111; color:#eee; }
    h1 { text-align:center; padding:15px; background:#222; color:#ff4444; margin:0; }
    #description { text-align:center; padding:10px; background:#1a1a1a; font-size:14px; color:#ccc; }
    #map { height:50vh; }
    #content { padding:15px; }
    .post { margin-bottom:20px; padding:15px; background:#222; border-radius:8px; }
    .post h2 { margin:0 0 10px; color:#66ccff; }
    /* æŠ½å±œ */
    #drawer {
      height:100%; width:0; position:fixed; top:0; left:0;
      background:#222; overflow-x:hidden; transition:0.3s; padding-top:60px;
      display:flex; flex-direction:column;
    }
    #drawer a { padding:8px 16px; text-decoration:none; color:#eee; display:block; }
    #drawer a:hover { background:#333; }
    #openDrawerBtn {
      position:fixed; top:20px; left:20px; font-size:20px; background:#ff4444; color:#fff;
      border:none; border-radius:50%; width:40px; height:40px; cursor:pointer;
    }
    #searchBox {
      margin:10px; padding:8px; border-radius:6px; border:none; width:80%;
      font-size:14px;
    }
    footer { text-align:center; padding:15px; background:#222; color:#aaa; font-size:12px; }
  </style>
</head>
<body>
  <h1>å°ç£ææ€–åœ°åœ–</h1>
  <div id="description">é€™è£¡è’é›†å…¨å°éˆç•°æ•…äº‹èˆ‡åœ°é»ï¼Œé»æ“Šå·¦å´æ¸…å–®å³å¯æŸ¥çœ‹ã€‚</div>

  <!-- æŠ½å±œæŒ‰éˆ• -->
  <button id="openDrawerBtn">â˜°</button>
  <div id="drawer">
    <a href="javascript:void(0)" onclick="closeDrawer()">âœ– é—œé–‰</a>
    <div id="regionList">è¼‰å…¥ä¸­...</div>
    <input id="searchBox" type="text" placeholder="ğŸ” æœå°‹æ–‡ç« ...">
  </div>

  <!-- ä¸ŠåŠéƒ¨åœ°åœ– -->
  <div id="map"></div>

  <!-- ä¸‹åŠéƒ¨æ–‡ç«  -->
  <div id="content"></div>

  <!-- åº•éƒ¨ -->
  <footer>
    è¯çµ¡ä¿¡ç®±ï¼šxxx@gmail.com ï½œ æœ¬ç¶²ç«™æ•…äº‹å…§å®¹ç´”å±¬æŠ•ç¨¿è€…ç¶“é©—åˆ†äº«ï¼Œåƒ…ä¾›åƒè€ƒï¼Œä¸ä»£è¡¨çœŸå¯¦ç™¼ç”Ÿã€‚
  </footer>

  <!-- Google Maps -->
  <script>
    let map;
    function initMap() {
      const taiwan = { lat: 23.6978, lng: 120.9605 };
      map = new google.maps.Map(document.getElementById("map"), {
        zoom: 7, center: taiwan,
      });
    }
  </script>
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap"></script>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "YOUR_FIREBASE_KEY",
      authDomain: "xxx.firebaseapp.com",
      projectId: "xxx",
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let allPosts = []; // å­˜æ‰€æœ‰æ–‡ç« 

    // è¼‰å…¥æ–‡ç« 
    async function loadPosts() {
      const querySnapshot = await getDocs(collection(db, "posts"));
      let groups = {};
      let contentDiv = document.getElementById("content");
      contentDiv.innerHTML = "";
      allPosts = []; // å…ˆæ¸…ç©º

      querySnapshot.forEach((doc) => {
        let data = doc.data();
        let region = data.locationName || "æœªåˆ†é¡";
        if (!groups[region]) groups[region] = [];
        groups[region].push(data);
        allPosts.push(data);

        // é¡¯ç¤ºæ–‡ç« ï¼ˆä¸é¡¯ç¤ºä½œè€…ï¼‰
        let div = document.createElement("div");
        div.className = "post";
        div.innerHTML = `<h2>${data.title}</h2><p>${data.content}</p><p><b>åœ°é»ï¼š</b>${region}</p>`;
        contentDiv.appendChild(div);
      });

      renderDrawer(groups);
    }

    // æŠ½å±œæ¸…å–®
    function renderDrawer(groups) {
      const regionList = document.getElementById("regionList");
      regionList.innerHTML = "";
      for (let region in groups) {
        let h3 = document.createElement("h3");
        h3.style.color = "#66ccff";
        h3.style.padding = "5px 15px";
        h3.innerText = region;
        regionList.appendChild(h3);

        groups[region].forEach(post => {
          let a = document.createElement("a");
          a.innerText = post.title;
          a.href = "#";
          a.onclick = () => {
            if (post.coordinates) {
              let [lat, lng] = post.coordinates.split(",").map(Number);
              let pos = { lat, lng };
              map.setCenter(pos);
              map.setZoom(14);
              new google.maps.Marker({ position: pos, map: map, title: post.title });
              window.scrollTo({ top:0, behavior:"smooth" });
            }
          };
          regionList.appendChild(a);
        });
      }
    }

    // æœå°‹åŠŸèƒ½
    document.getElementById("searchBox").addEventListener("input", function() {
      const keyword = this.value.toLowerCase();
      const contentDiv = document.getElementById("content");
      contentDiv.innerHTML = "";

      allPosts
        .filter(p => p.title.toLowerCase().includes(keyword) || p.content.toLowerCase().includes(keyword))
        .forEach(p => {
          let div = document.createElement("div");
          div.className = "post";
          div.innerHTML = `<h2>${p.title}</h2><p>${p.content}</p><p><b>åœ°é»ï¼š</b>${p.locationName || "æœªåˆ†é¡"}</p>`;
          contentDiv.appendChild(div);
        });
    });

    // æŠ½å±œæ§åˆ¶
    function openDrawer() { document.getElementById("drawer").style.width = "250px"; }
    function closeDrawer() { document.getElementById("drawer").style.width = "0"; }
    document.getElementById("openDrawerBtn").onclick = openDrawer;

    loadPosts();
  </script>
</body>
</html>
