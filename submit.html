<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>我要投稿 - 台灣恐怖地圖</title>
  <style>
    body { font-family: Arial, sans-serif; background:#111; color:#eee; margin:0; }
    h1 { text-align:center; padding:15px; background:#222; color:#ff4444; margin:0; cursor: pointer; }
    h2 { text-align:center; color:#66ccff; margin-top:10px; font-weight:normal; }

    #formContainer { 
      max-width: 900px; 
      margin: 20px auto; 
      background:#222; 
      padding:20px; 
      border-radius:12px; 
      box-shadow:0 0 10px rgba(0,0,0,0.5);
    }

    iframe { width:100%; height:700px; border:none; border-radius:8px; }

    footer { 
      margin-top:30px; 
      padding:20px; 
      background:#222; 
      text-align:center; 
      font-size:14px; 
      color:#bbb; 
    }

    #backToTop {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #ff4444;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow:0 4px 8px rgba(0,0,0,0.4);
    }
    #backToTop img {
      width: 24px;
      height: 24px;
    }

    #goHomeBtn {
      display: block;
      margin: 10px auto;
      background: #66ccff;
      color: #111;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
    #goHomeBtn:hover {
      background: #55bbff;
    }
  </style>
</head>
<body>
  <h1 onclick="goHome()">台灣恐怖地圖</h1>
  <h2>我要投稿 - 分享你的故事</h2>

  <button id="goHomeBtn" onclick="goHome()">🏠 回首頁</button>

  <div id="formContainer">
    <iframe src="https://forms.gle/6YLTnDS8nPDyFPrdA" frameborder="0" marginheight="0" marginwidth="0">載入中…</iframe>
  </div>

  <!-- 回到頂端 -->
  <button id="backToTop" onclick="window.scrollTo({top:0, behavior:'smooth'});">
    <img src="https://cdn-icons-png.flaticon.com/512/892/892692.png" alt="回到頂端">
  </button>

  <!-- 頁尾 -->
  <footer>
    聯絡信箱：noahorror708@gmail.com ｜ 本網站僅提供故事分享，內容不代表真實事件。<br>
    🆕 今日新增 <span id="todayCount">0</span> 篇 ｜ 📊 累計 <span id="totalCount">0</span> 篇
    <br>© 2025 台灣恐怖地圖 All Rights Reserved.
  </footer>

  <!-- Firebase Firestore -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCK8DBDjoj5pZg3vaGtktVyUuWOPUxDumU",
      authDomain: "taiwan-horror-map.firebaseapp.com",
      projectId: "taiwan-horror-map"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function updatePostStats() {
      const snap = await getDocs(collection(db, "posts"));
      document.getElementById("totalCount").innerText = snap.size;

      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const todayISO = today.toISOString();

      let todayCount = 0;
      snap.forEach(doc => {
        const data = doc.data();
        if (data.createdAt && new Date(data.createdAt).toISOString() >= todayISO) {
          todayCount++;
        }
      });
      document.getElementById("todayCount").innerText = todayCount;
    }

    updatePostStats();

    // 回首頁功能（跳到最新文章區塊）
    window.goHome = function () {
      window.location.href = "index.html#latest";
    };
  </script>
</body>
</html>
